<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Treino de Acordes</title>

<style>
    * {
        box-sizing: border-box;
    
    }
    :root {
        --bg: #111;
        --card: #1c1c1c;
        --text: #fff;
        --subtext: #ccc;
        --input: #333;
    }

    body.light {
        --bg: #f2f2f2;
        --card: #ffffff;
        --text: #111;
        --subtext: #555;
        --input: #e5e5e5;
    }

    body {
        font-family: Arial, sans-serif;
        background: var(--bg);
        color: var(--text);
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
    }

    .container {
        background: var(--card);
        padding: 30px;
        border-radius: 14px;
        width: 600px;
        position: relative;
    }

    h1 {
        text-align: center;
        margin-bottom: 25px;
        font-size: 32px;
    }

    .field {
        margin-bottom: 18px;
    }

    label {
        font-size: 18px;
        display: block;
        margin-bottom: 6px;
        color: var(--subtext);
    }

    input, select {
        width: 100%;
        padding: 16px 18px;
        font-size: 20px;
        border-radius: 8px;
        border: none;
        background: var(--input);
        color: var(--text);
    }

    .buttons {
        display: flex;
        gap: 15px;
        margin-top: 25px;
    }

    button {
        flex: 1;
        padding: 16px;
        font-size: 22px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        color: #fff;
    }

    button.start {
        background: #2ecc71;
    }

    button.stop {
        background: #e74c3c;
    }

    .display {
        margin-top: 35px;
        text-align: center;
    }

    .current {
        font-size: 120px;
        font-weight: bold;
        line-height: 1;
    }

    .next {
        font-size: 42px;
        color: var(--subtext);
        margin-top: 12px;
    }

    /* SWITCH DE TEMA */
    .theme-toggle {
        position: absolute;
        top: 15px;
        right: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 18px;
        user-select: none;
    }

    .switch {
        position: relative;
        width: 54px;
        height: 28px;
    }

    .switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .slider {
        position: absolute;
        cursor: pointer;
        inset: 0;
        background: #777;
        border-radius: 30px;
        transition: 0.3s;
    }

    .slider::before {
        content: "";
        position: absolute;
        height: 22px;
        width: 22px;
        left: 3px;
        top: 3px;
        background: white;
        border-radius: 50%;
        transition: 0.3s;
    }

    .switch input:checked + .slider {
        background: #bbb;
    }

    .switch input:checked + .slider::before {
        transform: translateX(26px);
    }
</style>
</head>

<body>
<div class="container">
    <div class="theme-toggle">
        üåô
        <label class="switch">
            <input type="checkbox" onchange="toggleTheme()">
            <span class="slider"></span>
        </label>
        ‚òÄÔ∏è
    </div>

    <h1>Treino de Acordes</h1>

    <div class="field">
        <label>Acordes (separe por v√≠rgula)</label>
        <input id="acordes" placeholder="Ex: C, D, F#, Am, G7" />
    </div>

    <div class="field">
        <label>Velocidade (BPM)</label>
        <input id="bpm" type="number" value="80" />
    </div>

    <div class="field">
        <label>Modo</label>
        <select id="modo">
            <option value="sequencial">Sequencial</option>
            <option value="aleatorio">Aleat√≥rio</option>
        </select>
    </div>

    <div class="buttons">
        <button class="start" onclick="iniciar()">Iniciar</button>
        <button class="stop" onclick="parar()">Parar</button>
    </div>

    <div class="display">
        <div class="current" id="acordeAtual">‚Äî</div>
        <div class="next" id="acordeProximo"></div>
    </div>
</div>

<script>
let intervalo = null;
let timeoutId = null;
let rodando = false;

let lista = [];
let indice = 0;
let ultimoAcorde = null;
let proximoAcorde = null;

const ANTECIPACAO_MS = 300;

function toggleTheme() {
    document.body.classList.toggle('light');
}

function iniciar() {
    parar();
    rodando = true;

    lista = document.getElementById('acordes')
        .value
        .split(',')
        .map(a => a.trim())
        .filter(a => a.length > 0);

    if (lista.length === 0) return;

    const bpm = parseInt(document.getElementById('bpm').value);
    const modo = document.getElementById('modo').value;
    const intervaloMs = 60000 / bpm;

    indice = 0;
    ultimoAcorde = null;

    proximoAcorde = escolherProximo(modo);
    document.getElementById('acordeProximo').textContent = "‚Üí " + proximoAcorde;

    intervalo = setInterval(() => {
        timeoutId = setTimeout(() => {
            if (!rodando) return;

            document.getElementById('acordeAtual').textContent = proximoAcorde;
            ultimoAcorde = proximoAcorde;
            tocarClick();

            proximoAcorde = escolherProximo(modo);
            document.getElementById('acordeProximo').textContent = "‚Üí " + proximoAcorde;

        }, intervaloMs - ANTECIPACAO_MS);
    }, intervaloMs);
}

function parar() {
    rodando = false;

    if (intervalo) clearInterval(intervalo);
    if (timeoutId) clearTimeout(timeoutId);

    intervalo = null;
    timeoutId = null;

    document.getElementById('acordeAtual').textContent = "‚Äî";
    document.getElementById('acordeProximo').textContent = "";
}

function escolherProximo(modo) {
    let candidato;

    if (modo === "sequencial") {
        do {
            candidato = lista[indice % lista.length];
            indice++;
        } while (candidato === ultimoAcorde && lista.length > 1);
    } else {
        do {
            candidato = lista[Math.floor(Math.random() * lista.length)];
        } while (candidato === ultimoAcorde && lista.length > 1);
    }

    return candidato;
}

function tocarClick() {
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();

    osc.frequency.value = 1000;
    osc.type = "square";

    gain.gain.setValueAtTime(0.15, ctx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.05);

    osc.connect(gain);
    gain.connect(ctx.destination);

    osc.start();
    osc.stop(ctx.currentTime + 0.05);
}
</script>
</body>
</html>
